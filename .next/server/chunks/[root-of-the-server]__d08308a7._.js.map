{"version":3,"sources":["../../../lib/news.js","../../../src/pages/api/news.js","../../../node_modules/next/src/build/templates/pages-api.ts"],"sourcesContent":["import fetch from 'node-fetch';\nimport Parser from 'rss-parser';\nimport fs from 'fs/promises';\nimport path from 'path';\n// avoid MaxListeners warnings during frequent reloads in dev\nif (typeof process !== 'undefined' && process.setMaxListeners) process.setMaxListeners(20);\nconst DATA_DIR = path.join(process.cwd(), 'data');\nconst REMOVED_TAGS_FILE = path.join(DATA_DIR, 'removedTags.json');\nconst FEEDS_FILE = path.join(DATA_DIR, 'feeds.json');\n\n// Default feeds used as fallback\nconst DEFAULT_FEEDS = [\n  // Google News search RSS targeting Limoges municipales 2026 (reliable)\n  { url: 'https://news.google.com/rss/search?q=Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (Limoges municipales 2026)' },\n  { url: 'https://www.francebleu.fr/rss/infos.xml', name: 'France Bleu' },\n  \n  // Local and regional sources with strong Limoges coverage\n  { url: 'https://news.google.com/rss/search?q=site:lepopulaire.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (Le Populaire - Limoges)' },\n  { url: 'https://news.google.com/rss/search?q=site:lepopulaire.fr+Haute-Vienne+municipales+2026&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (Le Populaire - Haute-Vienne)' },\n\n  { url: 'https://news.google.com/rss/search?q=site:actu.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (Actu.fr - Limoges)' },\n\n  // Regional feeds\n  { url: 'https://france3-regions.francetvinfo.fr/nouvelle-aquitaine/rss', name: 'France 3 Nouvelle Aquitaine' },\n  { url: 'https://news.google.com/rss/search?q=site:francebleu.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (France Bleu - Limoges)' },\n\n  // Google News searches for specific electoral coverage\n  { url: 'https://news.google.com/rss/search?q=élections+municipales+Limoges+2026&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (élections municipales)' },\n  { url: 'https://news.google.com/rss/search?q=municipales+Limoges+candidats&hl=fr&gl=FR&ceid=FR:fr', name: 'Google News (candidats Limoges)' }\n];\n\nasync function loadFeeds(){\n  try{\n    await fs.mkdir(DATA_DIR, { recursive: true });\n    const raw = await fs.readFile(FEEDS_FILE, 'utf8');\n    const feeds = JSON.parse(raw);\n    return Array.isArray(feeds) && feeds.length > 0 ? feeds : DEFAULT_FEEDS;\n  }catch(e){\n    if(e.code !== 'ENOENT') console.warn('loadFeeds failed:', e.message || String(e));\n    return DEFAULT_FEEDS;\n  }\n}\n\nasync function readRemovedTags(){\n  try{\n    await fs.mkdir(DATA_DIR, { recursive: true });\n    const raw = await fs.readFile(REMOVED_TAGS_FILE, 'utf8');\n    return JSON.parse(raw || '[]');\n  }catch(e){ \n    if(e.code === 'ENOENT') return []; \n    console.warn('readRemovedTags failed:', e.message || String(e)); \n    return []; \n  }\n}\n\nexport { readRemovedTags, loadFeeds };\n\nexport const parser = new Parser();\nexport const RSS_FEEDS = [...DEFAULT_FEEDS];\n\n// Load feeds from file on module initialization (non-blocking, for local development)\nif (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {\n  (async () => {\n    try {\n      RSS_FEEDS.length = 0; // Clear array\n      const loaded = await loadFeeds();\n      RSS_FEEDS.push(...loaded);\n      console.log(`Loaded ${RSS_FEEDS.length} feeds from ${FEEDS_FILE}`);\n    } catch(e) {\n      console.warn('Failed to load feeds:', e.message || String(e));\n    }\n  })();\n}\n\n// Save feeds to file (for persistence across serverless instances)\nexport async function saveFeeds() {\n  try {\n    await fs.mkdir(DATA_DIR, { recursive: true });\n    await fs.writeFile(FEEDS_FILE, JSON.stringify(RSS_FEEDS, null, 2), 'utf8');\n    console.log(`Saved ${RSS_FEEDS.length} feeds to ${FEEDS_FILE}`);\n    return true;\n  } catch(e) {\n    console.warn('saveFeeds failed:', e.message || String(e));\n    return false;\n  }\n}\n\nexport const ALTERNATIVE_FEEDS = {\n  'limoges.fr': [\n    'https://news.google.com/rss/search?q=site:limoges.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr',\n    'https://news.google.com/rss/search?q=Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr'\n  ],\n  'lamontagne.fr': [\n    'https://news.google.com/rss/search?q=site:lamontagne.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr'\n  ],\n  'francebleu.fr': [\n    'https://news.google.com/rss/search?q=site:francebleu.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr'\n  ],\n  'lepopulaire.fr': [\n    'https://news.google.com/rss/search?q=site:lepopulaire.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr'\n  ],\n  'actu.fr': [\n    'https://news.google.com/rss/search?q=site:actu.fr+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr'\n  ]\n};\n\nexport const feedFailures = new Map();\nexport const blacklistedFeeds = new Set();\nexport const MAX_FEED_FAILURES = 3;\nexport const MAX_AGE_DAYS = 60;\n\n// Sources considered highly trusted / prioritized for permissive matching\nconst SOURCE_PRIORITY = [\n  'lepopulaire','le populaire','la montagne','lamontagne','france bleu','francebleu','actu.fr','france 3','france3','limoges.fr'\n];\n\n// Clean up old entries to prevent memory leak\nfunction cleanupOldFailures() {\n  const MAX_ENTRIES = 100;\n  if (feedFailures.size > MAX_ENTRIES) {\n    const entries = Array.from(feedFailures.entries());\n    // Keep only the most recent 50% of entries\n    const toKeep = entries.slice(-Math.floor(MAX_ENTRIES / 2));\n    feedFailures.clear();\n    toKeep.forEach(([k, v]) => feedFailures.set(k, v));\n  }\n}\n\n// Run cleanup every 10 minutes (guarded to avoid duplicate intervals on reload)\nif (typeof setInterval !== 'undefined') {\n  if (!global.__NEWS_CLEANUP_INTERVAL_SET) {\n    global.__NEWS_CLEANUP_INTERVAL_SET = true;\n    setInterval(cleanupOldFailures, 10 * 60 * 1000);\n  }\n}\n\nconst EXCLUDED_SOURCES = ['linternaute.com', 'linternaute'];\n\nfunction isExcludedSource(item){\n  const url = (item.url || '').toLowerCase();\n  const source = (item.source || '').toLowerCase();\n  const title = (item.title || '').toLowerCase();\n  const description = (item.description || '').toLowerCase();\n  return EXCLUDED_SOURCES.some(s => url.includes(s) || source.includes(s) || title.includes(s) || description.includes(s));\n}\n\n// Normalize text by lowercasing and removing accents\nexport function normalizeTextSimple(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\n\n// Compare two strings after normalization, collapsing whitespace and trimming\nexport function sameText(a, b){ const norm = s => (normalizeTextSimple(s)||'').replace(/\\s+/g,' ').trim(); return norm(a) === norm(b); }\n\nexport async function handleFeedFailure(url, name, reason){\n  const count = (feedFailures.get(url) || 0) + 1;\n  feedFailures.set(url, count);\n  console.warn(`Failed to fetch feed ${url} ${reason ? reason : ''} (failure ${count}/${MAX_FEED_FAILURES})`);\n  if (count < MAX_FEED_FAILURES) return;\n\n  try {\n    const host = (new URL(url)).hostname.replace(/^www\\./,'');\n    const alts = [];\n    for(const key of Object.keys(ALTERNATIVE_FEEDS)){\n      if(host.includes(key)) alts.push(...ALTERNATIVE_FEEDS[key]);\n    }\n\n    if (alts.length > 0){\n      let added = 0;\n      for(const alt of alts){\n        if (!RSS_FEEDS.some(f => f.url === alt) && !blacklistedFeeds.has(alt)){\n          RSS_FEEDS.push({ url: alt, name: `Alternative for ${name || host}` });\n          feedFailures.set(alt, 0);\n          added++;\n          console.log(`Added alternative feed for ${host}: ${alt}`);\n        }\n      }\n      if (added > 0){\n        blacklistedFeeds.add(url);\n        console.log(`Replaced ${url} with ${added} alternative feed(s).`);\n        return;\n      }\n    }\n\n    // add generic alternative\n    try{\n      const genericAlt = `https://news.google.com/rss/search?q=site:${host}+Limoges+municipales+2026&hl=fr&gl=FR&ceid=FR:fr`;\n      if (!RSS_FEEDS.some(f => f.url === genericAlt) && !blacklistedFeeds.has(genericAlt)){\n        RSS_FEEDS.push({ url: genericAlt, name: `Generic alternative for ${host}` });\n        feedFailures.set(genericAlt, 0);\n        console.log(`Added generic alternative feed for ${host}: ${genericAlt}`);\n        blacklistedFeeds.add(url);\n        return;\n      }\n    } catch(e){ console.warn('Failed to add generic alternative for', host, e && e.message ? e.message : e); }\n\n    blacklistedFeeds.add(url);\n    console.warn(`Blacklisting feed ${url} after ${count} failures.`);\n  } catch (err){\n    console.warn('Error handling feed failure for', url, err && err.message ? err.message : err);\n    blacklistedFeeds.add(url);\n  }\n}\n\nconst KEYWORDS = [\n  'limoges','mairie','municipales','élection','election','élections','elections','candidat','candidats','2026',\n  'limousin','haute vienne','haute-vienne','hautevienne','87',\n  // nearby towns / communes to consider as regional evidence\n  'damien maudet','maudet','Albin Freychet','freychet',\n  'émile roger lombertie','emile roger lombertie','lombertie',\n  'thierry miguel','miguel',\n  'vincent léonie','vincent leonie','leonie'\n];\n\n// Town keys used for UI and strict matching (full Haute-Vienne communes, space and hyphen variants)\nexport const TOWN_KEYS = [\n  'aixe sur vienne',   'aixe-sur-vienne',   'ambazac',   'arnac la poste',   'arnac-la-poste',   'augne',   'aureil',   'azat le ris',\n  'azat-le-ris',   'balledent',   'beaumont du lac',   'beaumont-du-lac',   'bellac',   'berneuil',   'bersac sur rivalier',   'bersac-sur-rivalier',\n  'bessines sur gartempe',   'bessines-sur-gartempe',   'beynac',   'blanzac',   'blond',   'boisseuil',   'bonnac la cote',   'bonnac-la-cote',\n  'bosmie l aiguille',   'bosmie-l aiguille',   'bosmie-l-aiguille',   'breuilaufa',   'bujaleuf',   'burgnac',   'bussiere galant',   'bussiere-galant',\n  'chaillac sur vienne',   'chaillac-sur-vienne',   'chalus',   'chamboret',   'champagnac la riviere',   'champagnac-la-riviere',   'champnetery',   'champsac',\n  'chaptelat',   'chateau chervix',   'chateau-chervix',   'chateauneuf la foret',   'chateauneuf-la-foret',   'chateauponsac',   'cheissoux',   'cheronnac',\n  'cieux',   'cognac la foret',   'cognac-la-foret',   'compreignac',   'condat sur vienne',   'condat-sur-vienne',   'coussac bonneval',   'coussac-bonneval',\n  'couzeix',   'cromac',   'cussac',   'dinsac',   'dompierre les eglises',   'dompierre-les-eglises',   'domps',   'dournazac',\n  'droux',   'eybouleuf',   'eyjeaux',   'eymoutiers',   'feytiat',   'flavignac',   'folles',   'fromental',\n  'gajoubert',   'glandon',   'glanges',   'gorre',   'isle',   'jabreilles les bordes',   'jabreilles-les-bordes',   'janailhac',\n  'javerdat',   'jouac',   'jourgnac',   'la bazeuge',   'la chapelle montbrandeix',   'la chapelle-montbrandeix',   'la croisille sur briance',   'la croisille-sur-briance',\n  'la croix sur gartempe',   'la croix-sur-gartempe',   'la geneytouse',   'la jonchere saint maurice',   'la jonchere-saint-maurice',   'la meyze',   'la porcherie',   'la roche l abeille',\n  'la roche-l abeille',   'la-bazeuge',   'la-chapelle-montbrandeix',   'la-croisille-sur-briance',   'la-croix-sur-gartempe',   'la-geneytouse',   'la-jonchere-saint-maurice',   'la-meyze',\n  'la-porcherie',   'la-roche-l-abeille',   'ladignac le long',   'ladignac-le-long',   'lauriere',   'lavignac',   'le buis',   'le chalard',\n  'le chatenet en dognon',   'le chatenet-en-dognon',   'le dorat',   'le palais sur vienne',   'le palais-sur-vienne',   'le-palais-sur vienne',   'le vigen',   'le-buis',   'le-chalard',\n  'le-chatenet-en-dognon',   'le-dorat',   'le-palais-sur-vienne',   'le-vigen',   'les billanges',   'les cars',   'les grands chezeaux',   'les grands-chezeaux',\n  'les salles lavauguyon',   'les salles-lavauguyon',   'les-billanges',   'les-cars',   'les-grands-chezeaux',   'les-salles-lavauguyon',   'limoges',   'linards',\n  'lussac les eglises',   'lussac-les-eglises',   'magnac bourg',   'magnac laval',   'magnac-bourg',   'magnac-laval',   'mailhac sur benaize',   'mailhac-sur-benaize',\n  'maisonnais sur tardoire',   'maisonnais-sur-tardoire',   'marval',   'masleon',   'meilhac',   'meuzac',   'moissannes',   'montrol senard',\n  'montrol-senard',   'mortemart',   'nantiat',   'nedde',   'neuvic entier',   'neuvic-entier',   'nexon',   'nieul',\n  'nouic',   'oradour saint genest',   'oradour sur glane',   'oradour sur vayres',   'oradour-saint-genest',   'oradour-sur-glane',   'oradour-sur-vayres',   'pageas',\n  'panazol',   'pensol',   'peyrat de bellac',   'peyrat le chateau',   'peyrat-de-bellac',   'peyrat-le-chateau',   'peyrilhac',   'pierre buffiere',\n  'pierre-buffiere',   'rancon',   'razes',   'rempnat',   'rilhac lastours',   'rilhac rancon',   'rilhac-lastours',   'rilhac-rancon',\n  'rochechouart',   'royeres',   'roziers saint georges',   'roziers-saint-georges',   'saillat sur vienne',   'saillat-sur-vienne',   'saint amand le petit',   'saint amand magnazeix',\n  'saint auvent',   'saint bazile',   'saint bonnet briance',   'saint bonnet de bellac',   'saint brice sur vienne',   'saint cyr',   'saint denis des murs',   'saint gence',\n  'saint genest sur roselle',   'saint georges les landes',   'saint germain les belles',   'saint gilles les forets',   'saint hilaire bonneval',   'saint hilaire la treille',   'saint hilaire les places',   'saint jean ligoure',\n  'saint jouvent',   'saint julien le petit',   'saint junien',   'saint junien les combes',   'saint just le martel',   'saint laurent les eglises',   'saint laurent sur gorre',   'saint leger la montagne',\n  'saint leger magnazeix',   'saint leonard de noblat',   'saint martial sur isop',   'saint martin de jussac',   'saint martin le mault',   'saint martin le vieux',   'saint martin terressus',   'saint mathieu',\n  'saint maurice les brousses',   'saint meard',   'saint ouen sur gartempe',   'saint pardoux le lac',   'saint paul',   'saint priest ligoure',   'saint priest sous aixe',   'saint priest taurion',\n  'saint sornin la marche',   'saint sornin leulac',   'saint sulpice lauriere',   'saint sulpice les feuilles',   'saint sylvestre',   'saint victurnien',   'saint vitte sur briance',   'saint yrieix la perche',\n  'saint yrieix sous aixe',   'saint-amand-le-petit',   'saint-amand-magnazeix',   'saint-auvent',   'saint-bazile',   'saint-bonnet-briance',   'saint-bonnet-de-bellac',   'saint-brice-sur-vienne',\n  'saint-cyr',   'saint-denis-des-murs',   'saint-gence',   'saint-genest-sur-roselle',   'saint-georges-les-landes',   'saint-germain-les-belles',   'saint-gilles-les-forets',   'saint-hilaire-bonneval',\n  'saint-hilaire-la-treille',   'saint-hilaire-les-places',   'saint-jean-ligoure',   'saint-jouvent',   'saint-julien-le-petit',   'saint-junien',   'saint-junien-les-combes',   'saint-just-le-martel',\n  'saint-laurent-les-eglises',   'saint-laurent-sur-gorre',   'saint-leger-la-montagne',   'saint-leger-magnazeix',   'saint-leonard-de-noblat',   'saint-martial-sur-isop',   'saint-martin-de-jussac',   'saint-martin-le-mault',\n  'saint-martin-le-vieux',   'saint-martin-terressus',   'saint-mathieu',   'saint-maurice-les-brousses',   'saint-meard',   'saint-ouen-sur-gartempe',   'saint-pardoux-le-lac',   'saint-paul',\n  'saint-priest-ligoure',   'saint-priest-sous-aixe',   'saint-priest-taurion',   'saint-sornin-la-marche',   'saint-sornin-leulac',   'saint-sulpice-lauriere',   'saint-sulpice-les-feuilles',   'saint-sylvestre',\n  'saint-victurnien',   'saint-vitte-sur-briance',   'saint-yrieix-la-perche',   'saint-yrieix-sous-aixe',   'sainte anne saint priest',   'sainte marie de vaux',   'sainte-anne-saint-priest',   'sainte-marie-de-vaux',\n  'sauviat sur vige',   'sauviat-sur-vige',   'sereilhac',   'solignac',   'surdoux',   'sussac',   'tersannes',   'thouron',\n  'val d issoire',   'val d oire et gartempe',   'val-d oire-et-gartempe',   'val-d-issoire',   'val-d-oire-et-gartempe',   'vaulry',   'vayres',   'verneuil moustiers',\n  'verneuil sur vienne',   'verneuil-moustiers',   'verneuil-sur-vienne',   'veyrac',   'vicq sur breuilh',   'vicq-sur-breuilh',   'videix',   'villefavard'\n];\n\n// Combined keys for matching (keywords + towns)\n// Build lazily to avoid initialization order problems (ensure TOWN_KEYS is defined first)\nlet MATCH_KEYS_CACHE = null;\nexport function getMatchKeys(){\n  if (!MATCH_KEYS_CACHE) {\n    MATCH_KEYS_CACHE = [...new Set([...KEYWORDS, ...TOWN_KEYS])];\n  }\n  return MATCH_KEYS_CACHE;\n}\n\nexport function getMatches(text){\n  const n = normalizeTextSimple(text);\n  const found = [];\n  const keys = getMatchKeys();\n  for(const k of keys){\n    const nk = normalizeTextSimple(k);\n    if(nk && n.includes(nk)) found.push(k);\n  }\n  return [...new Set(found)];\n}\n\n// Strict match: require Limoges/region evidence (text or source/url). Election keywords boost but are no longer mandatory.\n// Towns like Saint-Junien are treated as region evidence so local communes are included.\n// Excludes articles mentioning other departments/regions (Normandie, Dordogne 24, etc.)\nexport function isStrictMatch(matches, context = {}){\n  const safeMatches = Array.isArray(matches) ? matches : [];\n  const norm = safeMatches.map(m => normalizeTextSimple(m));\n  \n  // Full text for exclusion check (title + description + source + url)\n  const fullText = normalizeTextSimple(\n    (context.title || '') + ' ' + \n    (context.description || '') + ' ' + \n    (context.source || '') + ' ' + \n    (context.url || '')\n  );\n\n  // Exclude articles mentioning other departments/regions (blacklist)\n  const excludeRegions = [\n    'normandie', 'bretagne', 'alsace', 'lorraine', 'bourgogne', 'franche-comte', 'franche comte',\n    'occitanie', 'provence', 'corse', 'rhone alpes', 'rhone-alpes', 'auvergne rhone',\n    'ile de france', 'ile-de-france', 'paris', 'lyon', 'marseille', 'toulouse', 'bordeaux', 'nantes',\n    'strasbourg', 'montpellier', 'nice', 'rennes', 'lille', 'reims',\n    // Départements limitrophes mais hors Haute-Vienne\n    'dordogne', '24420', '24', 'perigueux', 'bergerac', 'sarlat', 'sarliac', // Dordogne\n    // Vendée\n    'vendee', 'vendée', '85', 'la roche sur yon', 'la-roche-sur-yon', 'les sables d\\'olonne', 'les sables', 'challans',\n    'correze', '19', 'tulle', 'brive', 'brive la gaillarde', 'brive-la-gaillarde', 'malemort', 'ussel', 'egletons', // Corrèze\n    'creuse', '23', 'gueret', 'aubusson', // Creuse\n    'charente', '16', 'angouleme', 'cognac', // Charente\n    'vienne', '86', 'poitiers', 'chatellerault', 'loudun', // Vienne (attention à ne pas confondre avec Haute-Vienne)\n    'indre', '36', 'chateauroux', 'issoudun', // Indre\n    'deux sevres', 'deux-sevres', '79', 'niort', // Deux-Sèvres\n    'charente maritime', 'charente-maritime', '17', 'la rochelle', 'rochefort', 'saintes', // Charente-Maritime\n    'lot et garonne', 'lot-et-garonne', '47', 'agen', // Lot-et-Garonne\n    'gironde', '33', 'bordeaux', // Gironde (pour être sûr)\n    'puy de dome', 'puy-de-dome', '63', 'clermont-ferrand', // Puy-de-Dôme\n    'allier', '03', 'moulins', 'montlucon', // Allier\n    'cantal', '15', 'aurillac' // Cantal\n  ];\n  \n  // Check if TITLE or DESCRIPTION mentions excluded regions\n  const titleAndDesc = normalizeTextSimple(\n    (context.title || '') + ' ' + (context.description || '')\n  );\n  if (excludeRegions.some(r => titleAndDesc.includes(r))) {\n    // Exception: if title/description also clearly mentions Limoges/Haute-Vienne, keep it\n    // (don't just rely on source/URL which may generically mention \"Limoges municipales\")\n    const hasStrongLocalEvidenceInContent = titleAndDesc.includes('limoges') || titleAndDesc.includes('haute vienne') || titleAndDesc.includes('haute-vienne') || titleAndDesc.includes(' 87 ') || titleAndDesc.includes('87000') || titleAndDesc.includes('87100');\n    if (!hasStrongLocalEvidenceInContent) return false;\n  }\n\n  // check for Limoges/region in matches (include ONLY Haute-Vienne towns)\n  let hasRegion = norm.some(n => n.includes('limoges'));\n  if (!hasRegion) {\n    if (TOWN_KEYS.some(t => norm.some(n => n.includes(normalizeTextSimple(t))))) hasRegion = true;\n  }\n\n  // also consider source or url as evidence of region\n  const townKeys = TOWN_KEYS.map(t => normalizeTextSimple(t));\n  const src = normalizeTextSimple((context.source || '') + ' ' + (context.url || ''));\n  const hasRegionInSource = src.includes('limoges') || src.includes('limousin') || src.includes('haute vienne') || src.includes('haute-vienne') || src.includes('87') || townKeys.some(t => src.includes(t));\n  if (hasRegionInSource) hasRegion = true;\n\n  // election-related keywords (required), with exceptions when context/source explicitly suggests an election\n  const electionKeys = ['municipales','municipale','élection','election','élections','elections','scrutin','vote','candidat','candidats','liste','listes'];\n  // Candidate keywords that can act as election evidence when present in title/description/source/url\n  const candidateKeys = ['Albin Freychet','damien maudet','maudet','émile roger lombertie','emile roger lombertie','lombertie','thierry miguel','miguel','vincent leonie','vincent leonie','leonie'];\n\n  // check matches first (explicit keywords detected by getMatches)\n  const hasElectionInMatches = electionKeys.some(k => norm.some(n => n.includes(normalizeTextSimple(k))));\n\n  // also inspect the context (title/description/source/url) for either election keywords or candidate names\n  const ctxText = normalizeTextSimple((context.title || '') + ' ' + (context.description || '') + ' ' + (context.source || '') + ' ' + (context.url || ''));\n  const hasElectionInContext = electionKeys.some(k => ctxText.includes(normalizeTextSimple(k)));\n  const hasCandidateInContext = candidateKeys.some(c => ctxText.includes(normalizeTextSimple(c)));\n\n  const hasElection = hasElectionInMatches || hasElectionInContext || hasCandidateInContext;\n\n  if (!hasElection) return false;\n  // Correction: do not show news with only 'candidat', 'candidats', 'municipales', or 'elections' as match\n  const onlyElectionTags = ['municipales','elections','élections','election','2026'];\n  if (\n    norm.length === 1 &&\n    (norm[0] === 'candidat' || norm[0] === 'candidats' || onlyElectionTags.includes(norm[0]))\n  ) return false;\n  return hasRegion;\n}\n\nexport async function fetchRssFeeds(limit = 300, debug = false){\n  const items = [];\n  const reports = []; // per-feed debug reports\n  const preferDepartement = (process.env.PREFER_DEPARTEMENT || 'false').toString().toLowerCase() === 'true';\n\n  const scoreFor = (it) => {\n    let score = 0;\n    const src = (it.source || '').toLowerCase();\n\n    // Source priority\n    if (SOURCE_PRIORITY.some(p => src.includes(p))) score += 120;\n\n    // Prefer department if enabled and article mentions Haute-Vienne / Limousin / department indicators\n    const matches = (it.matches || []).map(m => normalizeTextSimple(m));\n    if (preferDepartement && matches.some(m => m.includes('haute vienne') || m.includes('haute-vienne') || m.includes('limousin') || m.includes('87'))) score += 200;\n\n    // More matches => higher score\n    score += (it.matches || []).length * 20;\n\n    // Non-google URL (direct site) gets boost\n    if (it.url && !it.url.includes('news.google.com')) score += 50;\n\n    // recency\n    const timeScore = it.publishedAt ? new Date(it.publishedAt).getTime() / 1e12 : 0;\n    score += timeScore;\n\n    // small tiebreaker: description length\n    score += (it.description || '').length / 5000;\n\n    return score;\n  };\n\n  await Promise.all(RSS_FEEDS.map(async (f) =>{\n    if (blacklistedFeeds.has(f.url)){\n      reports.push({ url: f.url, name: f.name, status: 'blacklisted', httpStatus: null, itemsFound: 0 });\n      return;\n    }\n    try{\n      const resp = await fetch(f.url, {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (X11; Linux) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36',\n          'Accept': 'application/rss+xml, application/xml, text/xml, */*'\n        }\n      });\n\n      if (!resp.ok){\n        await handleFeedFailure(f.url, f.name, `Status code ${resp.status}`);\n        reports.push({ url: f.url, name: f.name, status: 'error', httpStatus: resp.status, itemsFound: 0, error: `Status code ${resp.status}` });\n        return;\n      }\n\n      const xml = await resp.text();\n      const feed = await parser.parseString(xml);\n      const feedItems = (feed.items || []).map(it => {\n        const title = it.title;\n        let description = it.contentSnippet || it.content || it.summary || '';\n        if (sameText(title, description)) description = null;\n        return {\n          title,\n          description,\n          url: it.link,\n          source: f.name || feed.title || (new URL(f.url)).hostname,\n          publishedAt: it.isoDate || it.pubDate || null\n        };\n      });\n\n      // load global removed tags and use to filter matches (normalize & substring-aware)\n      const removedArr = (await readRemovedTags()).map(r => normalizeTextSimple(r));\n\n      const cutoff = new Date(Date.now() - MAX_AGE_DAYS * 24 * 3600 * 1000);\n      const filtered = feedItems.map(it => {\n        const text = (it.title || '') + ' ' + (it.description || '');\n        let matches = getMatches(text);\n        // remove any matches that are globally removed (normalize + substring-aware)\n        matches = matches.filter(m => {\n          const nm = normalizeTextSimple(m);\n          return !removedArr.some(rn => nm.includes(rn) || rn.includes(nm));\n        });\n        const primaryMatch = matches.length ? matches[0] : null;\n        const scored = Object.assign({}, it, { matches, primaryMatch, score: scoreFor(Object.assign({}, it, { matches })) });\n        return scored;\n      }).filter(it => {\n        if (isExcludedSource(it)) return false;\n        if (!it.publishedAt) return false;\n        const pubDate = new Date(it.publishedAt);\n        if (isNaN(pubDate)) return false;\n        if (pubDate < cutoff) return false;\n        return (it.matches && it.matches.length > 0);\n      });\n\n      reports.push({ url: f.url, name: f.name, status: 'ok', httpStatus: resp.status, itemsFound: filtered.length });\n      items.push(...filtered);\n    } catch (err){\n      await handleFeedFailure(f.url, f.name, err && err.message ? err.message : err);\n      reports.push({ url: f.url, name: f.name, status: 'error', httpStatus: null, itemsFound: 0, error: err && err.message ? err.message : String(err) });\n    }\n  }));\n\n  // sort by score desc, then by date desc\n  const final = items.filter(i => i.publishedAt).slice().sort((a,b)=>{\n    if ((b.score||0) !== (a.score||0)) return (b.score||0) - (a.score||0);\n    return new Date(b.publishedAt) - new Date(a.publishedAt);\n  });\n\n  if (debug) return { items: final.slice(0, limit), reports };\n  return final.slice(0, limit);\n}\n\nexport async function fetchAndParseFeed(url, limit = 5){\n  try{\n    const resp = await fetch(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (X11; Linux) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36',\n        'Accept': 'application/rss+xml, application/xml, text/xml, */*'\n      }\n    });\n    if(!resp.ok){ await handleFeedFailure(url, null, `Status code ${resp.status}`); throw new Error('Fetch failed: ' + resp.status); }\n    const xml = await resp.text();\n    const feed = await parser.parseString(xml);\n    const items = (feed.items || []).slice(0, limit).map(it => {\n      const title = it.title;\n      let description = it.contentSnippet || it.content || it.summary || '';\n      if (sameText(title, description)) description = null;\n      const urlItem = it.link;\n      const publishedAt = it.isoDate || it.pubDate || null;\n      const matches = getMatches((title || '') + ' ' + (description || ''));\n      return { title, description, url: urlItem, publishedAt, matches };\n    });\n    feedFailures.set(url, 0);\n    return items;\n  } catch(err){ throw err; }\n}","import { fetchRssFeeds } from '../../../lib/news.js';\n\nexport default async function handler(req, res) {\n  try {\n    const limit = parseInt(req.query.limit, 10) || 200;\n    const articles = await fetchRssFeeds(limit);\n    // Regrouper par mois pour la pagination\n    const monthlyArticles = {};\n    const months = [];\n    articles.forEach(article => {\n      if (article.publishedAt) {\n        const month = new Date(article.publishedAt).toLocaleString('fr-FR', { month: 'long', year: 'numeric' });\n        if (!monthlyArticles[month]) {\n          monthlyArticles[month] = [];\n          months.push(month);\n        }\n        monthlyArticles[month].push(article);\n      }\n    });\n    res.status(200).json({ articles, monthlyArticles, months });\n  } catch (e) {\n    res.status(500).json({ articles: [], monthlyArticles: {}, months: [], error: e.message });\n  }\n}\n","import type { NextApiResponse } from '../../types'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\n\nimport { sendError } from '../../server/api-utils'\nimport { RouteKind } from '../../server/route-kind'\nimport type { Span } from '../../server/lib/trace/tracer'\nimport { PagesAPIRouteModule } from '../../server/route-modules/pages-api/module.compiled'\n\nimport { hoist } from './helpers'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\nimport { getTracer, SpanKind } from '../../server/lib/trace/tracer'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport type { InstrumentationOnRequestError } from '../../server/instrumentation/types'\nimport { addRequestMeta } from '../../server/request-meta'\n\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export config.\nexport const config = hoist(userland, 'config')\n\n// Create and export the route module that will be consumed.\nconst routeModule = new PagesAPIRouteModule({\n  definition: {\n    kind: RouteKind.PAGES_API,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  userland,\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n})\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil?: (prom: Promise<void>) => void\n  }\n): Promise<void> {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  }\n\n  const prepareResult = await routeModule.prepare(req, res, { srcPage })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return\n  }\n\n  const { query, params, prerenderManifest, routerServerContext } =\n    prepareResult\n\n  try {\n    const method = req.method || 'GET'\n    const tracer = getTracer()\n\n    const activeSpan = tracer.getActiveScopeSpan()\n    const onRequestError =\n      routeModule.instrumentationOnRequestError.bind(routeModule)\n\n    const invokeRouteModule = async (span?: Span) =>\n      routeModule\n        .render(req, res, {\n          query: {\n            ...query,\n            ...params,\n          },\n          params,\n          allowedRevalidateHeaderKeys: process.env\n            .__NEXT_ALLOWED_REVALIDATE_HEADERS as any as string[],\n          multiZoneDraftMode: Boolean(process.env.__NEXT_MULTI_ZONE_DRAFT_MODE),\n          trustHostHeader: process.env\n            .__NEXT_TRUST_HOST_HEADER as any as boolean,\n          // TODO: get this from from runtime env so manifest\n          // doesn't need to load\n          previewProps: prerenderManifest.preview,\n          propagateError: false,\n          dev: routeModule.isDev,\n          page: 'VAR_DEFINITION_PAGE',\n\n          internalRevalidate: routerServerContext?.revalidate,\n\n          onError: (...args: Parameters<InstrumentationOnRequestError>) =>\n            onRequestError(req, ...args),\n        })\n        .finally(() => {\n          if (!span) return\n\n          span.setAttributes({\n            'http.status_code': res.statusCode,\n            'next.rsc': false,\n          })\n\n          const rootSpanAttributes = tracer.getRootSpanAttributes()\n          // We were unable to get attributes, probably OTEL is not enabled\n          if (!rootSpanAttributes) {\n            return\n          }\n\n          if (\n            rootSpanAttributes.get('next.span_type') !==\n            BaseServerSpan.handleRequest\n          ) {\n            console.warn(\n              `Unexpected root span type '${rootSpanAttributes.get(\n                'next.span_type'\n              )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n            )\n            return\n          }\n\n          const route = rootSpanAttributes.get('next.route')\n          if (route) {\n            const name = `${method} ${route}`\n\n            span.setAttributes({\n              'next.route': route,\n              'http.route': route,\n              'next.span_name': name,\n            })\n            span.updateName(name)\n          } else {\n            span.updateName(`${method} ${srcPage}`)\n          }\n        })\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await invokeRouteModule(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          invokeRouteModule\n        )\n      )\n    }\n  } catch (err) {\n    // we re-throw in dev to show the error overlay\n    if (routeModule.isDev) {\n      throw err\n    }\n    // this is technically an invariant as error handling\n    // should be done inside of api-resolver onError\n    sendError(res as NextApiResponse, 500, 'Internal Server Error')\n  } finally {\n    // We don't allow any waitUntil work in pages API routes currently\n    // so if callback is present return with resolved promise since no\n    // pending work\n    ctx.waitUntil?.(Promise.resolve())\n  }\n}\n"],"names":["sendError","RouteKind","PagesAPIRouteModule","hoist","userland","getTracer","SpanKind","BaseServerSpan","addRequestMeta","config","routeModule","definition","kind","PAGES_API","page","pathname","bundlePath","filename","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","query","params","prerenderManifest","routerServerContext","method","tracer","activeSpan","getActiveScopeSpan","onRequestError","instrumentationOnRequestError","bind","invokeRouteModule","span","render","allowedRevalidateHeaderKeys","__NEXT_ALLOWED_REVALIDATE_HEADERS","multiZoneDraftMode","Boolean","__NEXT_MULTI_ZONE_DRAFT_MODE","trustHostHeader","__NEXT_TRUST_HOST_HEADER","previewProps","preview","propagateError","dev","internalRevalidate","revalidate","onError","args","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","withPropagatedContext","headers","trace","spanName","SERVER","attributes","url","err"],"mappings":"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","ignoreList":[2]}